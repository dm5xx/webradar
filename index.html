<!DOCTYPE html>
<html>
<head>
	<title>Leaflet Quick Start Guide Example</title>
	<meta charset="utf-8" />

	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	
	<link rel="stylesheet" href="http://cdn.leafletjs.com/leaflet/v0.7.7/leaflet.css"/>
	<script src="http://code.jquery.com/jquery-1.10.2.min.js" language="javascript" type="text/javascript" style=""></script>
	<script src="http://code.jquery.com/ui/1.11.2/jquery-ui.js"></script>

	<style>
        body {
            padding: 0;
            margin: 0;
        }
        html, body, #map {
            height: 100%;
            width: 100%;
        }
    </style>
</head>
<body>
	<div id="map"></div>


	<script src="http://cdn.leafletjs.com/leaflet/v0.7.7/leaflet.js"></script>
	<script src="Leaflet.Geodesic.js"></script>
	<script type="text/javascript" src="L.Terminator.js"></script>
	<script src="globals.js"></script>
	<script src="dataHandler.js"></script>
	<script src="map_helper.js"></script>
	<script src="markerHandler.js"></script>
	<script src="dxBoxHandler.js"></script>
	<script src="documentReady.js"></script>

	<script>
		
/*		
		L.tileLayer('https://api.tiles.mapbox.com/v4/{id}/{z}/{x}/{y}.png?access_token=pk.eyJ1IjoibWFwYm94IiwiYSI6ImNpandmbXliNDBjZWd2M2x6bDk3c2ZtOTkifQ._QA7i5Mpkd_m30IGElHziw', {
			maxZoom: 18,
			attribution: 'Map data &copy; <a href="http://openstreetmap.org">OpenStreetMap</a> contributors, ' +
				'<a href="http://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, ' +
				'Imagery Â© <a href="http://mapbox.com">Mapbox</a>',
			id: 'mapbox.streets'
		}).addTo(map);



		var CartoDB_DarkMatter = L.tileLayer('http://{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}.png', {
			attribution: '&copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a> &copy; <a href="http://cartodb.com/attributions">CartoDB</a>',
			subdomains: 'abcd',
			maxZoom: 18
		});
		CartoDB_DarkMatter.addTo(map);
		

*/
		var MapQuestOpen_OSM = new L.tileLayer('http://otile{s}.mqcdn.com/tiles/1.0.0/{type}/{z}/{x}/{y}.{ext}', {
	type: 'map',
	ext: 'jpg',
	attribution: 'Tiles Courtesy of <a href="http://www.mapquest.com/">MapQuest</a> &mdash; Map data &copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a>',
	subdomains: '1234'
});
		///var map = L.map('map').setView([20, 30], 3, layers : [MapQuestOpen_OSM]);
		var mapCenter = new L.LatLng(20,30);
		var map = new L.map('map', { center : mapCenter, zoom : 3, layers : [MapQuestOpen_OSM] })
		MapQuestOpen_OSM.on("load", initmarkers);
		
		var berlin = new L.LatLng(52.5, 13.35); 
		var losangeles = new L.LatLng(33.82, -118.38);

		var A = L.marker(losangeles, {draggable: true}).addTo(map);
		var B = L.marker(berlin, {draggable: true}).addTo(map).bindPopup("Drag me.").openPopup();
		
		var Geodesic = L.geodesic([[A.getLatLng(), B.getLatLng()]], {
			weight: 1, 
			opacity: 0.5,
			color: 'blue',
			steps: 100
		}).addTo(map);
		
		var info = L.control();

		info.onAdd = function (map) {
		    this._div = L.DomUtil.create('div', 'info'); 
		    this.update();
		    return this._div;
		};
		
		info.update = function (props) {
		    this._div.innerHTML = '<h4>Distance</h4>' +  (props ? (props.distance>10000)?(props.distance/1000).toFixed(0)+' km':(props.distance).toFixed(0)+' m' : 'invalid');
		};
		info.addTo(map);		
		
		Geodesic.update = function () {
		  Geodesic.setLatLngs([[A.getLatLng(), B.getLatLng()]]);
		  info.update(Geodesic._vincenty_inverse(A.getLatLng(), B.getLatLng()));
		};
		
		Geodesic.update();
		
		A.on('drag', Geodesic.update);
		B.on('drag', Geodesic.update);
		
		var t = L.terminator();
		t.addTo(map);
		setInterval(function(){updateTerminator(t)}, 500);
		
		function updateTerminator(t) {
			var t2 = L.terminator();
			t.setLatLngs(t2.getLatLngs());
			t.redraw();
		}
				
	</script>
</body>
</html>